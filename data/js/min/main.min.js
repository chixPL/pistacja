import{CountUp}from"../../lib/countup/countUp.min.js";import"https://cdn.jsdelivr.net/npm/chart.js@4.2.0/dist/chart.umd.min.js";const text=document.getElementById("changeText"),progressbar=document.getElementById("resetprogress");let previous_data={temperature:0,wind_speed_kmh:0,pressure:0,rain_count:0,humidity:0};function get_range(t,e,r){return t>=e&&t<=r}function config(t,e){return{labels:["Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota","Niedziela"],datasets:[{label:t,data:e,backgroundColor:"#B20D3B",borderWidth:1}],options:{scales:{y:{beginAtZero:!0}}}}}class EventLoop{constructor(){this.counter=0,this.number=2}change=()=>{text.innerHTML="Odświeżenie za <span class='primarycolor'><b><u>"+(5-this.counter)+"</b></u></span> sekund",progressbar.style="width: "+20*this.counter+"%",progressbar.ariaValueNow=20*this.counter};requestData=()=>{this.number>5&&(this.number=2);const t=this;$.ajax({url:".db/sqlconnect.php",type:"POST",data:{num:this.number},dataType:"json",success:function(e){let r=new CountUp("temperature-value",e.temperature,{startVal:previous_data.temperature,decimalPlaces:2,duration:2}),a=new CountUp("wind-value",e.wind_speed_kmh,{startVal:previous_data.wind_speed_kmh,decimalPlaces:2,duration:2}),n=new CountUp("pressure-value",e.pressure,{startVal:previous_data.pressure,useGrouping:!1,duration:2}),o=new CountUp("rain-value",e.rain_count,{startVal:previous_data.rain_count,decimalPlaces:2,duration:2}),i=new CountUp("humidity-value",e.humidity,{startVal:previous_data.humidity,duration:2});r.start(),a.start(),n.start(),o.start(),i.start(),previous_data=e,t.number++;let s=337.5*Math.random(),u="N";get_range(s,1,20)&&(u="N"),get_range(s,21,60)&&(u="NE"),get_range(s,61,110)&&(u="E"),get_range(s,111,160)&&(u="SE"),get_range(s,161,200)&&(u="S"),get_range(s,201,250)&&(u="SW"),get_range(s,251,290)&&(u="W"),get_range(s,291,340)&&(u="NW"),u.length>1?document.getElementById("direction").style["margin-left"]="-5px":document.getElementById("direction").style["margin-left"]="0px",compass.style.transform="rotate("+s.toFixed(0)+"deg)",document.getElementById("direction").innerHTML="<b>"+u+"</b>"}})};main_loop=()=>{this.counter>5&&(this.requestData(),this.counter=0),this.change(),this.counter++}}let rnd_temp=Array.from({length:7},(()=>Math.ceil(30*Math.random()))),rnd_wind=Array.from({length:7},(()=>(6*Math.random()+0).toFixed(2)));const ctx_temp=document.getElementById("temp-chart"),ctx_wind=document.getElementById("wind-chart");new Chart(ctx_temp,{type:"bar",data:config("Temperatura (°C)",rnd_temp)}),new Chart(ctx_wind,{type:"bar",data:config("Prędkość wiatru (km/h)",rnd_wind)}),window.onload=t=>{let e=new EventLoop;e.requestData();setInterval(e.main_loop,1e3)};