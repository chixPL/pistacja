import{CountUp as e}from"../../lib/countup/countUp.min.js";import"../../lib/chartjs/chart.umd.min.js";const t=document.getElementById("resetprogress"),a=document.getElementById("countdown");let r={temperature:0,wind_speed_kmh:0,pressure:0,rain_count:0,humidity:0};function n(e,t,a){return e>=t&&e<=a}function s(e,t){return{labels:["Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota","Niedziela"],datasets:[{label:e,data:t,backgroundColor:"#B20D3B",borderWidth:1}],options:{scales:{y:{beginAtZero:!0}}}}}async function i(e="",t=0){(new FormData).append("num",t);return(await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"num="+t})).json()}class o{constructor(){this.counter=0,this.number=2}change=()=>{a.innerHTML=5-this.counter,t.style="width: "+20*this.counter+"%",t.ariaValueNow=20*this.counter};update=t=>{let a=new e("temperature-value",t.temperature,{startVal:r.temperature,decimalPlaces:2,duration:2}),s=new e("wind-value",t.wind_speed_kmh,{startVal:r.wind_speed_kmh,decimalPlaces:2,duration:2}),i=new e("pressure-value",t.pressure,{startVal:r.pressure,useGrouping:!1,duration:2}),o=new e("rain-value",t.rain_count,{startVal:r.rain_count,decimalPlaces:2,duration:2}),u=new e("humidity-value",t.humidity,{startVal:r.humidity,duration:2});a.start(),s.start(),i.start(),o.start(),u.start(),r=t,this.number++;let d=337.5*Math.random(),c="";switch(!0){case n(d,1,20):c="N";break;case n(d,21,60):c="NE";break;case n(d,61,110):c="E";break;case n(d,111,160):c="SE";break;case n(d,161,200):c="S";break;case n(d,201,250):c="SW";break;case n(d,251,290):c="W";break;case n(d,291,340):c="NW";break;case n(d,341,360):c="N"}c.length>1?document.getElementById("direction").style["margin-left"]="-5px":document.getElementById("direction").style["margin-left"]="0px",compass.style.transform="rotate("+d.toFixed(0)+"deg)",document.getElementById("direction").innerHTML="<b>"+c+"</b>"};requestData=()=>{this.number>5&&(this.number=2),i(".db/results.php",this.number).then((e=>{this.update(e)}))};main_loop=()=>{this.counter>5&&(this.requestData(),this.counter=0),this.change(),this.counter++}}let u=Array.from({length:7},(()=>Math.ceil(30*Math.random()))),d=Array.from({length:7},(()=>(6*Math.random()+0).toFixed(2)));const c=document.getElementById("temp-chart"),m=document.getElementById("wind-chart");new Chart(c,{type:"bar",data:s("Temperatura (°C)",u)}),new Chart(m,{type:"bar",data:s("Prędkość wiatru (km/h)",d)}),window.onload=e=>{let t=new o;t.requestData();setInterval(t.main_loop,1e3)};