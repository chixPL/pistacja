import{CountUp as t}from"../../lib/countup/countUp.min.js";import"../../lib/chartjs/chart.umd.min.js";const e=document.getElementById("changeText"),a=document.getElementById("resetprogress");let n={temperature:0,wind_speed_kmh:0,pressure:0,rain_count:0,humidity:0};function r(t,e,a){return t>=e&&t<=a}function i(t,e){return{labels:["Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota","Niedziela"],datasets:[{label:t,data:e,backgroundColor:"#B20D3B",borderWidth:1}],options:{scales:{y:{beginAtZero:!0}}}}}async function o(t="",e=0){(new FormData).append("num",e);return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"num="+e})).json()}class s{constructor(){this.counter=0,this.number=2}change=()=>{e.innerHTML="Odświeżenie za <span class='primarycolor'><b><u>"+(5-this.counter)+"</b></u></span> sekund",a.style="width: "+20*this.counter+"%",a.ariaValueNow=20*this.counter};update=e=>{let a=new t("temperature-value",e.temperature,{startVal:n.temperature,decimalPlaces:2,duration:2}),i=new t("wind-value",e.wind_speed_kmh,{startVal:n.wind_speed_kmh,decimalPlaces:2,duration:2}),o=new t("pressure-value",e.pressure,{startVal:n.pressure,useGrouping:!1,duration:2}),s=new t("rain-value",e.rain_count,{startVal:n.rain_count,decimalPlaces:2,duration:2}),u=new t("humidity-value",e.humidity,{startVal:n.humidity,duration:2});a.start(),i.start(),o.start(),s.start(),u.start(),n=e,this.number++;let d=337.5*Math.random(),m="N";r(d,1,20)&&(m="N"),r(d,21,60)&&(m="NE"),r(d,61,110)&&(m="E"),r(d,111,160)&&(m="SE"),r(d,161,200)&&(m="S"),r(d,201,250)&&(m="SW"),r(d,251,290)&&(m="W"),r(d,291,340)&&(m="NW"),m.length>1?document.getElementById("direction").style["margin-left"]="-5px":document.getElementById("direction").style["margin-left"]="0px",compass.style.transform="rotate("+d.toFixed(0)+"deg)",document.getElementById("direction").innerHTML="<b>"+m+"</b>"};requestData=()=>{this.number>5&&(this.number=2),o(".db/sqlconnect.php",this.number).then((t=>{this.update(t)}))};main_loop=()=>{this.counter>5&&(this.requestData(),this.counter=0),this.change(),this.counter++}}let u=Array.from({length:7},(()=>Math.ceil(30*Math.random()))),d=Array.from({length:7},(()=>(6*Math.random()+0).toFixed(2)));const m=document.getElementById("temp-chart"),l=document.getElementById("wind-chart");new Chart(m,{type:"bar",data:i("Temperatura (°C)",u)}),new Chart(l,{type:"bar",data:i("Prędkość wiatru (km/h)",d)}),window.onload=t=>{let e=new s;e.requestData();setInterval(e.main_loop,1e3)};